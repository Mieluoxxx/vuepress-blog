---
title: 28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ğŸŒŸ
---

ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² `haystack` å’Œ `needle` ï¼Œè¯·ä½ åœ¨ `haystack` å­—ç¬¦ä¸²ä¸­æ‰¾å‡º `needle` å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ `needle` ä¸æ˜¯ `haystack` çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å› `-1` ã€‚

 

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šhaystack = "sadbutsad", needle = "sad"
è¾“å‡ºï¼š0
è§£é‡Šï¼š"sad" åœ¨ä¸‹æ ‡ 0 å’Œ 6 å¤„åŒ¹é…ã€‚
ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯ 0 ï¼Œæ‰€ä»¥è¿”å› 0 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šhaystack = "leetcode", needle = "leeto"
è¾“å‡ºï¼š-1
è§£é‡Šï¼š"leeto" æ²¡æœ‰åœ¨ "leetcode" ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› -1 ã€‚
```



## æš´åŠ›åŒ¹é…

```cpp
class Solution {
public:
    int strStr(string haystack, string needle) {
        int n = haystack.size(), m = needle.size();
        for (int i = 0; i <= n - m; i++) {
            int j = i, k = 0;
            while (k < m && haystack[j] == needle[k]) {
                j++;
                k++;
            }
            if (k == m) return i;
        }
        return -1;
    }
};
```



## KMP

é¢˜è§£å‚è€ƒï¼š[å®«æ°´ä¸‰å¶](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/)
KMPç®—æ³•æ ¸å¿ƒ: 
- iæŒ‡é’ˆæ°¸ä¸å›å¤´
- nextæ•°ç»„çš„æ„å»º
![](https://pic.leetcode-cn.com/1618846927-xFAEXE-010FD8AE2B79FFE03DC3735ACD224A6A.png)

![](https://pic.leetcode-cn.com/1618847960-lkVIDM-B9497542844478144BED83E9ADA0C12F.png)

![](https://pic.leetcode-cn.com/1618847981-wncoqJ-161584A2D930A7B91092A2C3872D9DE5.png)

![](https://pic.leetcode-cn.com/1618847995-vRWimV-6127EBA37435560C20BB8B15D5B790B6.png)




```cpp
class Solution {
public:
    int strStr(string s, string p) {
        int n = s.size(), m = p.size();
        if(m == 0) return 0;
        //è®¾ç½®å“¨å…µ	ä¸ºäº†é¿å…j=-1çš„æƒ…å†µ
        s.insert(s.begin(),' ');
        p.insert(p.begin(),' ');
        vector<int> next(m + 1);
        //é¢„å¤„ç†nextæ•°ç»„
        for(int i = 2, j = 0; i <= m; i++){
            while(j and p[i] != p[j + 1]) j = next[j];
            if(p[i] == p[j + 1]) j++;
            next[i] = j;
        }
        //åŒ¹é…è¿‡ç¨‹
        for(int i = 1, j = 0; i <= n; i++){
            while(j and s[i] != p[j + 1]) j = next[j];
            if(s[i] == p[j + 1]) j++;
            if(j == m) return i - m;
        }
        return -1;
    }
};
```


æ•´ä¸ª next æ•°ç»„çš„æ„å»ºè¿‡ç¨‹ï¼Œæ—¶ç©ºå¤æ‚åº¦å‡ä¸º$O(m)$ã€‚

è‡³æ­¤æ•´ä¸ª KMP åŒ¹é…è¿‡ç¨‹å¤æ‚åº¦æ˜¯ $O(m + n)$ çš„

```cpp
class Solution {	// ä¸è®¾ç½®å“¨å…µ
public:
    int strStr(string s, string p) {
        int n = s.size(), m = p.size();
        if (m == 0) return 0;
        
        vector<int> next(m);
        for (int i = 1, j = 0; i < m; i++) {
          	// j > 0 å¯ä»¥è®©next[0]=0
            while (j > 0 && p[i] != p[j]) j = next[j - 1];	
            if (p[i] == p[j]) j++;
            next[i] = j;
        }

        for (int i = 0, j = 0; i < n; i++) {
            while (j > 0 && s[i] != p[j]) j = next[j - 1];
            if (s[i] == p[j]) j++;
            if (j == m) return i - m + 1;
        }
        return -1;
    }
};
```

