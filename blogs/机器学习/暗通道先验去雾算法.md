---
title: 暗通道先验去雾算法
date: 2023/12/01
categories:
    - 机器学习
tags: 
    - matlab
---

## 快速预览

暗通道先验去雾算法：

1. **定义暗通道：**

    - 算法的核心是“暗通道先验”，这是一种对天空中任何一幅图像的像素中最小值进行估计的方法。在大多数情况下，天空中的像素值最小，因此通过找到每个窗口中的最小值，可以得到图像的“暗通道”。

2. **估计大气光值（A）：**

    - 通过暗通道图像，可以估计图像中的大气光值。这是因为在有雾的地方，像素的值会被雾霾遮挡，而在无雾的地方，像素的值较大。取暗通道图像中前几个最大值作为大气光值的估计。

3. **估计透射率（t）：**

    - 利用估计的大气光值，通过一个全局常数 $w$ 来估计每个像素的透射率。透射率 $t$ 可以通过下面的公式来计算：

    $$
    t(x)=1-w\times min(darkchannel(I(x)/A))
    $$

    

    - 其中，$I(x)$ 是原始图像的像素值，$A$ 是估计的大气光值。

4. **去雾处理：**

    - 利用估计的透射率和大气光值，可以使用下面的公式对图像进行去雾处理：

    $$
    J(x)=\frac{I(x)-A}{max(t(x),t_{min})}+A
    $$

    

    -  其中，$J(x)$ 是去雾后的像素值，$t_{min}$ 是一个小的正数，用于避免除零错误。



## 背景

在计算机图形学中，一张有雾图像的合成模型广泛用以下算法表示：
$$
I(x)=J(x)t(x)+A(1-t(x))
$$
其中，$I$ 表示观察（有雾）图像，$J$ 表示清晰（无雾）图像，$A$ 代表大气光，$t$ 表示大气的透射率。

已知有雾图像 $I$ ，只要求出透射率 $t$ 以及大气光 $A$ ，那么就可以利用公式 (1) 计算无雾的图像 $J$ 。



## 暗通道先验

要想求得大气透射率 $t$ 与大气光强 $A$ ， 首先需要有一个基于统计的先验条件：

> In most of the non-sky patches, at least one color channel has very low intensity at some pixels. In other words, the minimum intensity in such a patch should has a very low value.

我们定义：
$$
J^{dark}(x)=\min_{c\in\{r,g,b\}}(\min_{y\in\Omega(x)}J^c(y))
$$
其中 $J^c$ 是 $J$ 图像的一个颜色通道， 是一块以 $x$ 为中心的区域点的集合，根据上述的先验条件，天空区域除外，一张自然图像的暗通道总是非常低甚至趋于零，即$ J^{dark}(x) \to 0$
